# 🔧 联机问题排查指南

## 快速检查清单

### 1️⃣ 服务器是否在运行？

**检查方法：**
```bash
# Windows PowerShell
netstat -ano | findstr :3000

# 如果看到输出，说明端口被占用（可能是服务器在运行）
# 如果没有输出，说明服务器未运行
```

**解决方案：**
```bash
# 启动服务器
npm start

# 或
node server.js
```

### 2️⃣ 依赖是否已安装？

**检查方法：**
```bash
# 检查 node_modules 文件夹是否存在
dir node_modules

# 如果不存在，需要安装
npm install
```

### 3️⃣ 端口是否被占用？

**如果端口被其他程序占用：**

**Windows:**
```bash
# 查找占用端口的进程
netstat -ano | findstr :3000

# 结束进程（替换 PID 为实际进程ID）
taskkill /PID <PID> /F
```

**或者使用其他端口：**
```bash
# 设置环境变量
set PORT=3001
npm start
```

### 4️⃣ 使用诊断工具

运行诊断脚本：
```bash
node check-connection.js
```

这个工具会自动检查：
- ✅ 端口是否可用
- ✅ 服务器是否在运行
- ✅ Socket.IO 配置是否正确

## 常见问题及解决方案

### ❌ 问题1: "连接失败" 或 "无法连接到服务器"

**可能原因：**
1. 服务器未启动
2. 端口被占用
3. 防火墙阻止连接

**解决方案：**
1. 确保服务器正在运行：`npm start`
2. 检查端口是否被占用
3. 检查防火墙设置，允许 Node.js 访问网络

### ❌ 问题2: "跨域错误" (CORS Error)

**已修复！** 我已经在 `server.js` 中添加了 CORS 配置，支持跨域连接。

如果仍有问题，检查：
- 服务器是否使用最新代码
- 浏览器控制台是否有其他错误

### ❌ 问题3: "Socket.IO 连接超时"

**可能原因：**
1. 网络问题
2. 服务器响应慢
3. 代理设置问题

**解决方案：**
1. 检查网络连接
2. 查看服务器日志是否有错误
3. 如果使用代理，检查代理配置

### ❌ 问题4: 本地可以连接，但远程无法连接

**可能原因：**
1. 服务器未部署到支持 WebSocket 的平台
2. 平台不支持长连接（如 Vercel）

**解决方案：**
- 使用支持 WebSocket 的平台（Render、Railway、Fly.io）
- 参考 `DEPLOY.md` 了解部署详情

## 测试连接

### 方法1: 使用测试页面

1. 启动服务器：`npm start`
2. 打开浏览器访问：`http://localhost:3000/test-connection.html`
3. 查看连接状态和日志

### 方法2: 使用浏览器控制台

1. 打开游戏页面：`http://localhost:3000`
2. 按 F12 打开开发者工具
3. 查看 Console 标签页
4. 应该看到：`✅ 已连接到服务器`

### 方法3: 检查网络请求

1. 打开开发者工具 (F12)
2. 切换到 Network 标签页
3. 刷新页面
4. 查找 `socket.io` 相关的请求
5. 应该看到状态码为 200 或 101 (WebSocket 升级)

## 修复内容

我已经做了以下修复：

1. ✅ **添加 CORS 配置** - 支持跨域连接
2. ✅ **改进连接配置** - 添加自动重连机制
3. ✅ **增强错误处理** - 更清晰的错误提示
4. ✅ **创建诊断工具** - `check-connection.js` 帮助排查问题

## 下一步

如果问题仍然存在：

1. 运行诊断工具：`node check-connection.js`
2. 查看服务器日志（终端输出）
3. 查看浏览器控制台错误信息
4. 检查防火墙和网络设置

## 快速启动步骤

```bash
# 1. 安装依赖（如果还没安装）
npm install

# 2. 启动服务器
npm start

# 3. 打开浏览器访问
# http://localhost:3000

# 4. 如果无法连接，运行诊断
node check-connection.js
```

## 需要帮助？

如果以上方法都无法解决问题，请提供：
1. 服务器日志（终端输出）
2. 浏览器控制台错误信息
3. 诊断工具的输出结果

